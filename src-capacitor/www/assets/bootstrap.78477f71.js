import{a as T,u as f,A as c,R as u,b as m,o as w,c as p}from"./base.bf638541.js";import{bx as l,br as _,aG as k,ay as y,W as b,a2 as C}from"./index.90ead00b.js";import{u as A}from"./sms.892ef9cc.js";import{u as E}from"./timetable.f64b6fb9.js";import{u as g}from"./procedures.b20ac606.js";import{u as I}from"./specialists.07b97c72.js";import{S as v}from"./roles.61f7d6b9.js";import{api as P}from"./api.9988d825.js";import"./schedule.c0af0d3a.js";import"./date-time.d466b3fd.js";import"./isTomorrow.a3ceb101.js";import"./_commonjsHelpers.2cf1d77b.js";import"./dayjs.228bf609.js";import"./time.3f06d08e.js";import"./toasts.5fba8d07.js";async function x({redirect:e,ssrContext:s}){const t=l,r=T(),o=f();try{if(r.profile)return;if(o.accessToken){await r.fetchProfile();return}e("/login/")}catch(a){if(a.status===401){e({name:"dashboard",query:{refreshToken:"true"}});return}if(a.status===403){t.remove(c),t.remove(u),e("/login/");return}throw a}}async function M({currentRoute:e,redirect:s}){const t=m();if(!["companyCreate"].includes(e.name)&&!t.current){if(t.hasPositions===!1){s({name:"companyCreate"});return}await t.fetch()}}async function R(e){const s=A(),t=m(),r=E(),o=g(),a=I();if(!t.current)return;const n=s.isAuthorize;await Promise.all([r.fetch(),o.fetch(),a.fetch(),n&&s.fetchBalance()])}async function B({currentRoute:e,redirect:s}){const t=m();if(["companyCreate"].includes(e.name))return;const r=t.role,o=t.currentId;if(r.name===v){if(/\/specialist\//.test(e.path)&&Number(e.params.slug)===o)return;s({name:"specialistInfo",params:{slug:o}})}}async function N({redirect:e,ssrContext:s,currentRoute:t}){if(!t.query.refreshToken)return;const r=f(),o=l;try{const a=o.get(c),n=o.get(u),{role:h,companyId:S,userId:d}=w(a),i=await P.auth.refreshToken({role:h,userId:d,companyId:S,refreshToken:n});o.set(c,i.accessToken,{expires:p}),o.set(u,i.refreshToken,{expires:p}),r.accessToken=i.accessToken,r.refreshToken=i.refreshToken,await r.authorize(),e({name:"dashboard"})}catch{return o.remove(c),o.remove(u),e({name:"login"})}}const O={async preFetch(e){await N(e),await x(e),await M(e),await R(),await B(e)}},K={class:"bootstrap-layout"};function $(e,s,t,r,o,a){const n=k("RouterView");return y(),b("div",K,[C(n)])}var Z=_(O,[["render",$]]);export{Z as default};
