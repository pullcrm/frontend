import{u as J}from"./quasar.esm.prod.c88b943c.js";import{by as Z,af as L,Q as s,ac as ee,a9 as te,bC as se,bE as ne,a4 as S,bD as N,aG as h,ay as d,W as k,a2 as t,X as b,b1 as u,A as E,x as l,bp as A,a1 as g,I as F,aE as Q,U as $,D as I,V as M,k as O,as as V,ao as ae,C as oe,br as ue,aA as ie,bw as ce}from"./index.90ead00b.js";import{u as W}from"./popup.f1a4d1c1.js";import{u as P,a as Y,I as re,i as le,C as _e}from"./schedule.c0af0d3a.js";import{a as pe}from"./render.5e4deb99.js";import{u as H}from"./timetable.f64b6fb9.js";import"./dayjs.228bf609.js";import{_ as de}from"./DatePicker.53fe15d2.js";import{d as x}from"./isTomorrow.a3ceb101.js";import{_ as me,a as fe,b as he}from"./Column.33db15ed.js";import{u as ve}from"./specialists.07b97c72.js";import{p as ye,s as w}from"./time.3f06d08e.js";import{f as ge}from"./money.dd3f296a.js";import{api as be}from"./api.9988d825.js";import{S as De}from"./Loader.9c247aee.js";import"./date-time.d466b3fd.js";import"./base.bf638541.js";import"./_commonjsHelpers.2cf1d77b.js";import"./toasts.5fba8d07.js";import"./index.9890a0fb.js";import"./roles.61f7d6b9.js";var ke=Z({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(v,{slots:o}){const{proxy:{$q:n}}=te(),e=L(se);L(ne,()=>{console.error("QPage needs to be child of QPageContainer")});const i=s(()=>{const a=(e.header.space===!0?e.header.size:0)+(e.footer.space===!0?e.footer.size:0);if(typeof v.styleFn=="function"){const c=e.isContainer.value===!0?e.containerHeight.value:n.screen.height;return v.styleFn(a,c)}return{minHeight:e.isContainer.value===!0?e.containerHeight.value-a+"px":n.screen.height===0?a!==0?`calc(100vh - ${a}px)`:"100vh":n.screen.height-a+"px"}}),r=s(()=>`q-page ${v.padding===!0?" q-layout-padding":""}`);return()=>ee("main",{class:r.value,style:i.value},pe(o.default))}});const Ce={class:"schedule-page-queue-schedule-date-picker"},xe={class:"schedule-page-queue-schedule-date-picker__footer"},$e=g(" \u0421\u044C\u043E\u0433\u043E\u0434\u043D\u0456 "),Se=g(" \u0417\u0430\u0432\u0442\u0440\u0430 "),j=S({emits:["input"],setup(v){const o=N(),n=P(),e=H(),i=s({get(){return new Date(n.date)},set(m){const p=x(m).format("YYYY-MM-DD");o.replace({query:{date:p}}),n.date=p,n.fetch()}}),r=s(()=>x(i.value).isToday()),a=s(()=>x(i.value).isTomorrow());s(()=>e.normalizeTimetable);function c(){r.value||(i.value=new Date)}function _(){a.value||(i.value=x().add(1,"day").toDate())}return(m,p)=>{const y=h("UiText");return d(),k("div",Ce,[t(de,{class:"schedule-page-queue-schedule-date-picker__date-picker"}),b("div",xe,[t(y,{tag:"a",href:"#",size:"m",class:E(["schedule-page-queue-schedule-date-picker__button",{active:l(r)}]),"data-test":"date-picker-today",onClick:A(c,["prevent"])},{default:u(()=>[$e]),_:1},8,["class","onClick"]),t(y,{tag:"a",href:"#",size:"m",class:E(["schedule-page-queue-schedule-date-picker__button",{active:l(a)}]),"data-test":"date-picker-tomorrow",onClick:A(_,["prevent"])},{default:u(()=>[Se]),_:1},8,["class","onClick"])])])}}});const Te={class:"schedule-page-sidebar"},Ue={class:"schedule-page-sidebar__inner"},we=g(" \u0427\u0435\u0440\u0433\u0430 "),ze=g(" \u0414\u043E\u0434\u0430\u0442\u0438 \u0432 \u0447\u0435\u0440\u0433\u0443 "),Be=S({setup(v){const o=W(),n=Y(),e=s(()=>n.queue);function i(){o.show({name:"appointment",props:{type:"new",defaultStatus:re}})}function r(a){o.show({name:"appointment",props:{type:"edit",appointment:a}})}return(a,c)=>{const _=h("UiTitle"),m=h("UiText");return d(),k("div",Te,[b("div",Ue,[t(j,{class:"schedule-page-sidebar__schedule-date-picker"}),t(_,{size:"s",class:"schedule-page-sidebar__title"},{default:u(()=>[we]),_:1}),(d(!0),k(F,null,Q(l(e),p=>(d(),$(me,{key:`queue-${p.id}`,appointment:p,class:"schedule-page-sidebar__appointment",onOpen:r},null,8,["appointment"]))),128)),b("div",{class:"schedule-page-sidebar__action",onClick:i},[t(m,{size:"l",responsive:"","left-icon":"outlined/note-pencil"},{default:u(()=>[ze]),_:1})])])])}}});const Ie=S({setup(v){return(o,n)=>{const e=h("UiButton"),i=h("UiPopover");return d(),$(i,{size:"m",placement:"top_end",class:"schedule-page-date-picker-button"},{body:u(({close:r})=>[t(j,{onInput:r},null,8,["onInput"])]),default:u(()=>[t(e,{class:"schedule-page-date-picker-button__button",size:"l",theme:"blue","left-icon":"outlined/calendar"})]),_:1})}}});const Ae={class:"schedule-column-specialist__info"},Me=b("span",null," - ",-1),Pe=g(" \u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 "),qe=g(" \u0417\u0430\u043A\u0440\u0438\u0442\u0438 \u0437\u0430\u043F\u0438\u0441 "),Ee=b("br",null,null,-1),Oe=g(" \u043D\u0430 \u0446\u0435\u0439 \u0434\u0435\u043D\u044C "),Ye=S({props:{specialist:{type:Object,required:!0}},setup(v){const o=v,n=N(),e=P(),i=H(),r=Y(),a=s(()=>o.specialist.status),c=s(()=>o.specialist.user),_=s(()=>{var f;return(f=c.value.avatar)==null?void 0:f.path}),m=s(()=>e.timeOffs),p=s(()=>i.timeWork),y=s(()=>m.value.some(f=>f.specialistId!==o.specialist.id?!1:le(f,p.value))),U=s(()=>r.appointments.filter(({specialist:f})=>f.id===o.specialist.id)),D=s(()=>U.value.length),C=s(()=>U.value.filter(({status:f})=>f===_e).reduce((f,{total:z})=>f+z,0));async function K(){const{from:f,to:z}=p.value,B=new Date(e.date),T=w(B,f).format("YYYY-MM-DD HH:mm:ss"),q=w(B,z).format("YYYY-MM-DD HH:mm:ss");await be.timeOff.create({specialistId:o.specialist.id,endDateTime:q,startDateTime:T,description:""}),await e.fetchTimeOffs()}async function R(){await n.push({name:"specialistInfo",params:{slug:o.specialist.id}})}return(f,z)=>{const B=h("UiAvatar"),T=h("UiText"),q=h("UiIcon"),G=h("UiDropdownList"),X=h("UiDropdownMenu");return d(),k("div",{class:E(["schedule-column-specialist",[`_status_${l(a)}`]])},[t(B,{class:"schedule-column-specialist__avatar",image:l(_),name:l(c).fullName,size:"s"},null,8,["image","name"]),b("div",Ae,[t(T,{class:"schedule-column-specialist__name",size:"s"},{default:u(()=>[g(I(l(c).fullName),1)]),_:1}),t(T,{class:"schedule-column-specialist__total",size:"s"},{default:u(()=>[g(I(l(D))+" "+I(l(ye)(l(D),"\u043A\u043B\u0456\u0454\u043D\u0442","\u043A\u043B\u0456\u0454\u043D\u0442\u0430","\u043A\u043B\u0456\u0454\u043D\u0442\u0456\u0432"))+" ",1),Me,g(" "+I(l(ge)(l(C))),1)]),_:1})]),t(X,{placement:"bottom_end"},{inner:u(()=>[t(q,{class:"schedule-column-specialist__icon",size:"s",name:"outlined/dots-three-vertical"})]),default:u(()=>[t(G,null,{default:u(()=>[t(T,{tag:"a",href:"#",size:"m","left-icon":"outlined/pencil",onClick:A(R,["prevent"])},{default:u(()=>[Pe]),_:1},8,["onClick"]),l(y)===!1?(d(),$(T,{key:0,tag:"a",href:"#",size:"m","left-icon":"outlined/prohibit",onClick:A(K,["prevent"])},{default:u(()=>[qe,Ee,Oe]),_:1},8,["onClick"])):M("",!0)]),_:1})]),_:1})],2)}}});const He={key:0,class:"schedule-active-time"},Le=["data-time"],Ne=S({setup(v){const n=O(0),e=O(null),i=H(),r=s(()=>i.timeWork);V(()=>{const{from:c,to:_}=r.value;a(c,_);const m=setInterval(()=>a(c,_),6e4);ae(()=>{clearInterval(m)})});function a(c,_){const m=(w(new Date,_).unix()-w(new Date,c).unix())/60,p=(x(new Date).unix()-w(new Date,c).unix())/60;if(n.value=p*100/m,n.value<0||n.value>100){e.value=null;return}e.value=x(new Date).format("HH:mm")}return(c,_)=>e.value?(d(),k("div",He,[b("div",{class:"schedule-active-time__inner",style:oe(`top: ${n.value}%;`),"data-time":e.value},null,12,Le)])):M("",!0)}});const Fe={},Qe={class:"schedule-column-placeholder"};function Ve(v,o){return d(),k("div",Qe)}var We=ue(Fe,[["render",Ve]]);const je={class:"schedule"},Ke={class:"schedule__columns"},Re=S({props:{loading:{type:Boolean,default:!1}},setup(v){const o=O(null);ie("getUiTooltipContainer",()=>o.value);const n=P(),e=ve(),i=Y(),r=s(()=>n.date),a=s(()=>x(r.value).isToday()),c=s(()=>e.specialists),_=s(()=>n.normalizeTimeOffs),m=s(()=>i.appointments),p=s(()=>c.value.filter(({status:y})=>y!=="HIDE").map(y=>{const U=m.value.filter(C=>C.specialist.id===y.id);return{timeOffs:_.value.filter(({specialistId:C})=>C===y.id),specialist:y,appointments:U}}));return(y,U)=>(d(),k("div",je,[t(fe,{class:"schedule__timeline"}),l(a)?(d(),$(Ne,{key:0})):M("",!0),b("div",{ref_key:"inner",ref:o,class:"schedule__inner"},[v.loading?(d(),$(De,{key:0})):M("",!0),b("div",Ke,[(d(!0),k(F,null,Q(l(p),(D,C)=>(d(),$(he,{key:`column-${C}`,class:"schedule__column","time-offs":D.timeOffs,specialist:D.specialist,appointments:D.appointments},{append:u(()=>[t(Ye,{class:"schedule__specialist",specialist:D.specialist},null,8,["specialist"])]),_:2},1032,["time-offs","specialist","appointments"]))),128)),t(We)])],512)]))}});const Ge={class:"schedule-page__header"},Xe=g(" \u041A\u0430\u043B\u0435\u043D\u0434\u0430\u0440 "),Je=g(" \u0414\u043E\u0434\u0430\u0442\u0438 \u0437\u0430\u043F\u0438\u0441 "),bt=S({setup(v){J({title:"\u041A\u0430\u043B\u0435\u043D\u0434\u0430\u0440 - pullcrm"});const o=ce(),n=W(),e=P(),i=s(()=>e.isLoading);V(async()=>{const{date:a}=o.query;a&&(e.date=String(a)),await e.fetch()});async function r(){await n.show({name:"appointment",props:{type:"new"}})}return(a,c)=>{const _=h("UiTitle"),m=h("UiButton"),p=h("UiContainer"),y=h("Portal");return d(),$(ke,{class:"schedule-page"},{default:u(()=>[t(p,null,{default:u(()=>[b("div",Ge,[t(_,{size:"m",responsive:""},{default:u(()=>[Xe]),_:1}),t(m,{size:"s",theme:"blue","right-icon":"outlined/plus",onClick:r},{default:u(()=>[Je]),_:1})]),t(Re,{class:"schedule-page__schedule",loading:l(i)},null,8,["loading"])]),_:1}),t(Ie,{class:"schedule-page__date-picker-button"}),t(y,{to:"sidebar"},{default:u(()=>[t(Be)]),_:1})]),_:1})}}});export{bt as default};
