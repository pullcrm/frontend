var R=Object.defineProperty;var F=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var $=(n,l,u)=>l in n?R(n,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):n[l]=u,T=(n,l)=>{for(var u in l||(l={}))X.call(l,u)&&$(n,u,l[u]);if(F)for(var u of F(l))J.call(l,u)&&$(n,u,l[u]);return n};import{a4 as K,k as D,Q as x,aY as Z,aG as s,ay as M,U as ee,b1 as i,a2 as e,X as h,x as V,W as ue,I as te,V as ae,bp as oe,a1 as C}from"./index.53588f62.js";import{u as ie}from"./toasts.113f48d8.js";import{u as le,i as se}from"./schedule.da7e5da2.js";import{u as ne}from"./timetable.70b57e2e.js";import{u as me}from"./specialists.56f430f2.js";import{V as y,a as re,u as de}from"./index.e6dcdd48.js";import{t as pe,f as fe}from"./date-time.d466b3fd.js";import{s as I}from"./time.8571a5e6.js";import{_ as ce}from"./DatePicker.06e76f12.js";import{api as Y}from"./api.50e126cb.js";import"./base.686dbe64.js";import"./dayjs.228bf609.js";import"./isTomorrow.a3ceb101.js";import"./_commonjsHelpers.2cf1d77b.js";import"./roles.61f7d6b9.js";const ve=C(" \u0417\u043C\u0456\u043D\u0438\u0442\u0438 "),_e=["onSubmit"],Te=C(" \u0417\u0430\u043A\u0440\u0438\u0442\u0438 \u0437\u0430\u043F\u0438\u0441 \u043D\u0430 \u0432\u0435\u0441\u044C \u0434\u0435\u043D\u044C "),Ve={class:"time-off-edit-popup__actions"},Ue=C(" \u0417\u0431\u0435\u0440\u0435\u0433\u0442\u0438 "),De=C(" \u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438 "),Ye=K({name:"Edit",props:{timeOff:{type:Object,required:!0},specialistId:{type:Number,default:null},time:{type:String,default:null}},emits:["close"],setup(n,{emit:l}){const u=n,E=ie(),B=le(),S=ne(),O=me(),r=D(se({startDateTime:u.timeOff.startDateTime,endDateTime:u.timeOff.endDateTime},S.timeWork)),d=D(!1),t=D({id:u.timeOff.id,endTime:u.timeOff.endTime,specialist:O.specialists.find(({id:m})=>m===u.timeOff.specialistId),startTime:u.timeOff.startTime,description:u.timeOff.description}),v=D(pe(u.timeOff.startDateTime).toDate()),p=x(()=>S.workingHours),H=x(()=>{if(!t.value.startTime)return[];const m=p.value.indexOf(t.value.startTime);return p.value.filter((a,_)=>m<_)}),z={specialist:T({},y("\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u0441\u043F\u0435\u0446\u0456\u0430\u043B\u0456\u0441\u0442\u0430")),startTime:!r.value&&T({},y("\u0412\u043A\u0430\u0436\u0456\u0442\u044C \u0447\u0430\u0441 \u043F\u043E\u0447\u0430\u0442\u043A\u0443")),endTime:!r.value&&T({},y("\u0412\u043A\u0430\u0436\u0456\u0442\u044C \u0447\u0430\u0441 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u044F")),description:T({},re("\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u0430 \u043A\u0456\u043B\u044C\u043A\u0456\u0441\u0442\u044C \u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432: 255",255))},k=de(z,t);async function N(){if(!!await k.$validate())try{d.value=!0;const a=I(v.value,t.value.endTime).format("YYYY-MM-DD HH:mm:ss"),_=I(v.value,t.value.startTime).format("YYYY-MM-DD HH:mm:ss");await Y.timeOff.update(t.value.id,{specialistId:t.value.specialist.id,endDateTime:a,startDateTime:_,description:t.value.description}),await B.fetchTimeOffs(),w()}finally{d.value=!1}}async function q(){d.value=!0;try{await Y.timeOff.delete(t.value.id),await B.fetchTimeOffs(),E.show({title:"\u0412\u0438\u0434\u0430\u043B\u0435\u043D\u043E!"}),w()}finally{d.value=!1}}async function w(){l("close")}return Z(()=>r.value,m=>{m&&(t.value.endTime=p.value[p.value.length-1],t.value.startTime=p.value[0])}),(m,a)=>{const _=s("UiBack"),P=s("UiTitle"),b=s("UiSelect"),f=s("UiField"),A=s("UiInput"),L=s("UiPopover"),W=s("UiText"),j=s("UiSwitch"),g=s("UiButton"),G=s("UiFormValidator"),Q=s("UiPopup");return M(),ee(Q,{class:"time-off-edit-popup",onClose:a[7]||(a[7]=c=>m.$emit("close"))},{default:i(()=>[e(_,{onBack:a[0]||(a[0]=c=>m.$emit("close"))}),e(P,{class:"time-off-edit-popup__title",size:"s"},{default:i(()=>[ve]),_:1}),h("form",{onSubmit:oe(N,["prevent"])},[e(G,{validate:V(k)},{default:i(({resetFieldError:c,getFieldError:U})=>[e(f,{label:"\u0421\u043F\u0435\u0446\u0456\u0430\u043B\u0456\u0441\u0442",required:"",error:U("specialist")},{default:i(()=>[e(b,{modelValue:t.value.specialist,"onUpdate:modelValue":[a[1]||(a[1]=o=>t.value.specialist=o),o=>c("specialist")],options:V(O).specialists,"label-key":"fullName",placeholder:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0441\u043F\u0435\u0446\u0456\u0430\u043B\u0456\u0441\u0442\u0430",clearable:!1},null,8,["modelValue","options","onUpdate:modelValue"])]),_:2},1032,["error"]),e(L,{class:"time-off-edit-popup__popover",size:"m",placement:"bottom_start"},{body:i(()=>[e(ce,{modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=o=>v.value=o)},null,8,["modelValue"])]),default:i(()=>[e(f,{label:"\u0414\u0430\u0442\u0430"},{default:i(()=>[e(A,{"model-value":V(fe)(v.value,"D MMMM"),readonly:"","left-icon":"outlined/pencil"},null,8,["model-value"])]),_:1})]),_:1}),e(f,null,{default:i(()=>[e(j,{modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=o=>r.value=o),size:"m"},{append:i(()=>[e(W,{size:"m"},{default:i(()=>[Te]),_:1})]),_:1},8,["modelValue"])]),_:1}),r.value===!1?(M(),ue(te,{key:0},[e(f,{label:"\u0427\u0430\u0441 \u043F\u043E\u0447\u0430\u0442\u043A\u0443",required:"",error:U("startTime")},{default:i(()=>[e(b,{modelValue:t.value.startTime,"onUpdate:modelValue":[a[4]||(a[4]=o=>t.value.startTime=o),o=>c("startTime")],options:V(p),placeholder:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0447\u0430\u0441 \u043F\u043E\u0447\u0430\u0442\u043A\u0443"},null,8,["modelValue","options","onUpdate:modelValue"])]),_:2},1032,["error"]),e(f,{label:"\u0427\u0430\u0441 \u0437\u0430\u043A\u0456\u043D\u0447\u0435\u043D\u043D\u044F",required:"",error:U("endTime")},{default:i(()=>[e(b,{modelValue:t.value.endTime,"onUpdate:modelValue":[a[5]||(a[5]=o=>t.value.endTime=o),o=>c("endTime")],options:V(H),placeholder:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0447\u0430\u0441 \u0437\u0430\u043A\u0456\u043D\u0447\u0435\u043D\u043D\u044F"},null,8,["modelValue","options","onUpdate:modelValue"])]),_:2},1032,["error"])],64)):ae("",!0),e(f,{label:"\u041A\u043E\u0440\u043E\u0442\u043A\u0438\u0439 \u043E\u043F\u0438\u0441",error:U("description")},{default:i(()=>[e(A,{modelValue:t.value.description,"onUpdate:modelValue":a[6]||(a[6]=o=>t.value.description=o),tag:"textarea",placeholder:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043E\u043F\u0438\u0441",onInput:o=>c("description")},null,8,["modelValue","onInput"])]),_:2},1032,["error"]),h("div",Ve,[e(g,{type:"submit",size:"l",theme:"blue",loading:d.value},{default:i(()=>[Ue]),_:1},8,["loading"]),e(g,{size:"l",theme:"danger-outlined",loading:d.value,onClick:q},{default:i(()=>[De]),_:1},8,["loading"])])]),_:1},8,["validate"])],40,_e)]),_:1})}}});export{Ye as default};
