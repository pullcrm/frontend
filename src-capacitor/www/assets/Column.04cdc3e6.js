import{u as V}from"./timetable.70b57e2e.js";import{a4 as D,af as X,k as $,Q as t,aG as U,ay as l,W as g,X as _,a2 as O,b1 as E,a1 as b,D as f,x as u,U as A,V as J,A as ee,C as N,I as F,aE as G,aF as te}from"./index.53588f62.js";import{a as ne,b as se,c as w}from"./time.8571a5e6.js";import{u as j}from"./popup.f1b7e5e0.js";import{S as oe,T as ie,d as q}from"./base.686dbe64.js";import{u as ae}from"./toasts.113f48d8.js";import{u as ue,b as W,s as Q,c as re,g as le,d as ce,I as Y,C as pe,e as me}from"./schedule.da7e5da2.js";import{o as _e}from"./index.ca9f222c.js";import{api as de}from"./api.50e126cb.js";import{f as fe}from"./money.dd3f296a.js";const ve=_("div",{class:"appointment__divider"},null,-1),Te={class:"appointment__inner"},ge={class:"appointment__header"},he={class:"appointment__title"},ye=_("div",{class:"appointment__space"},null,-1),ke={class:"appointment__footer"},Se={class:"appointment__price"},xe=D({name:"Appointment",props:{appointment:{type:Object,required:!0},responsive:{type:Boolean,default:!1}},setup(o){const e=o,n=X("getPopperMenu"),i=j(),c=ae(),r=ue(),v=V(),a=$(null),k=$(null),h=$(!1),C=t(()=>{const{status:m,source:S}=e.appointment;return S===oe&&m===W?"IN_PROGRESS_WIDGET":m}),M=t(()=>Q[e.appointment.status]),H=t(()=>re[e.appointment.source]),P=t(()=>le(e.appointment)),T=t(()=>ce(e.appointment)),s=t(()=>v.workingHours);t(()=>ne(s.value,{timeStart:e.appointment.startTime,totalTime:T.value}));const d=t(()=>T.value<30?"xs":T.value<45?"s":T.value<60?"m":T.value<75?"l":"xl"),y=t(()=>e.appointment.startTime),p=t(()=>{const m=T.value/ie;return se(s.value,y.value,m)}),I=t(()=>{if(e.appointment.status!==Y)return{gridRow:`${w(y.value)}-start / ${w(p.value)}-start`,gridColumn:"start / end"}});function K(){var x,B;if(!n)return;const m=n();if(m.reference===((x=k.value)==null?void 0:x.root)||e.appointment.status===Y)return;const S={name:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438",icon:"outlined/pencil",click:()=>L()},z=[W,pe,me].map(R=>({name:Q[R],icon:R===e.appointment.status?"outlined/check":"outlined/minus",click:()=>Z(R)}));m.open((B=k.value)==null?void 0:B.root,{options:[S,...z],placement:"bottom_start"})}async function Z(m){await de.appointments.updateStatus(e.appointment.id,{status:m}),await c.show({title:"\u0412\u0438\u043A\u043E\u043D\u0430\u043D\u043E"}),await r.fetch()}function L(){i.show({name:"appointment",props:{type:"edit",appointment:e.appointment}})}return _e(a,()=>{h.value&&(h.value=!1)}),(m,S)=>{const z=U("UiBadge"),x=U("UiText");return l(),g("div",{ref_key:"root",ref:a,class:ee(["appointment",`appointment_size_${u(d)}`,`appointment_status_${u(C)}`,{"appointment_is-active":h.value},{appointment_responsive:o.responsive}]),style:N(u(I)),onDblclick:L,onClick:S[0]||(S[0]=B=>h.value=!0)},[ve,_("div",Te,[_("div",ge,[O(z,{ref_key:"statusBadge",ref:k,size:"m",theme:"custom",clickable:"",onClick:K},{default:E(()=>[b(f(u(M)),1)]),_:1},512),O(x,{size:"s",class:"appointment__type"},{default:E(()=>[b(f(u(H)),1)]),_:1})]),_("div",he,f(o.appointment.fullName),1),O(x,{class:"appointment__sub-title",size:"s"},{default:E(()=>[b(f(u(P)),1)]),_:1}),ye,_("div",ke,[o.appointment.startTime?(l(),A(x,{key:0,size:"s","left-icon":"outlined/clock",class:"appointment__duration"},{default:E(()=>[b(f(u(y))+" - "+f(u(p)),1)]),_:1})):J("",!0),_("div",Se,f(u(fe)(o.appointment.total)),1)])])],38)}}});const Ee={class:"schedule-timeline"},ze=D({name:"Timeline",setup(o){const e=V(),n=t(()=>e.workingHours),i=t(()=>n.value.filter((c,r)=>r%2===0));return(c,r)=>{const v=U("UiText");return l(),g("div",Ee,[(l(!0),g(F,null,G(u(i),a=>(l(),g("div",{key:a,class:"schedule-timeline__item"},[O(v,{size:"s"},{default:E(()=>[b(f(a),1)]),_:2},1024)]))),128))])}}});const be=D({name:"HourTile",props:{time:{type:String,required:!0}},setup(o,{expose:e}){const n=o,i=$(null),c=t(()=>{const r=w(n.time);return{gridRow:`${r}-start / ${r}-end`,gridColumn:"start / end"}});return e({icon:i}),(r,v)=>{const a=U("UiIcon");return l(),g("div",{class:"schedule-hour-tile",style:N(u(c))},[_("div",{ref_key:"icon",ref:i,class:"schedule-hour-tile__icon"},[O(a,{size:"xs",name:"outlined/plus"})],512)],4)}}});const $e=D({name:"TimeOff",props:{timeOff:{type:Object,required:!0}},setup(o){const e=o,n=j(),i=t(()=>e.timeOff.description.slice(0,15)),c=t(()=>w(e.timeOff.startTime)),r=t(()=>w(e.timeOff.endTime)),v=t(()=>({gridRow:`${c.value}-start / ${r.value}-start`,gridColumn:"start / end"}));function a(){n.show({name:"time-off-edit",props:{timeOff:e.timeOff}})}return(k,h)=>{const C=U("UiText");return l(),A(C,{class:"schedule-timeoff",size:"l",responsive:"",style:N(u(v)),onDblclick:a},{default:E(()=>[b(f(u(i)),1)]),_:1},8,["style"])}}});const we={class:"schedule-column"},Be=D({name:"Column",props:{specialist:null,appointments:null,timeOffs:null},setup(o){const e=o,n=$(null),i=X("getPopperMenu"),c=$(null),r=j(),v=V(),a=t(()=>v.workingHours),k=t(()=>a.value.map((s,d)=>(s=w(s),d===a.value.length-1?`[${s}-start] 0px [${s}-end] 0`:`[${s}-start] ${q}px [${s}-end] 0`)).join(" ")),h=t(()=>({gridTemplateColumns:"[start] 100% [end] 0",gridTemplateRows:k.value}));function C(){var p,I;if(!n.value||!i)return;const s=i();if(s.reference===((p=c.value)==null?void 0:p.icon))return;const d={name:"\u0414\u043E\u0434\u0430\u0442\u0438 \u0437\u0430\u043F\u0438\u0441",icon:"outlined/plus-circle",click:M},y={name:"\u0417\u0430\u043A\u0440\u0438\u0442\u0438 \u0437\u0430\u043F\u0438\u0441",icon:"outlined/prohibit",click:H};s.open((I=c.value)==null?void 0:I.icon,{name:`\u041F\u043E\u0447\u0430\u0442\u043E\u043A: ${n.value}`,options:[d,y],placement:"right"})}function M(){!n.value||r.show({name:"appointment",props:{type:"new",time:n.value,specialistId:e.specialist.id}})}function H(){r.show({name:"time-off-new",props:{time:n.value,specialistId:e.specialist.id}})}function P(s){if(!i)return;const d=Math.floor(s.offsetY/q);s.offsetY>0&&a.value[d]!==n.value&&(i().close(),n.value=a.value[d])}function T(){!i||i().isOpened||(n.value=null)}return(s,d)=>{const y=be;return l(),g("div",we,[te(s.$slots,"append"),_("div",{class:"schedule-column__grid",style:N(u(h))},[(l(!0),g(F,null,G(o.appointments,p=>(l(),A(xe,{key:`appointment-${p.id}`,responsive:"",appointment:p},null,8,["appointment"]))),128)),(l(!0),g(F,null,G(o.timeOffs,p=>(l(),A($e,{key:`time-off-${p.id}`,"time-off":p},null,8,["time-off"]))),128)),n.value?(l(),A(y,{key:0,ref_key:"hourTile",ref:c,time:n.value,specialist:o.specialist,class:"schedule-column__hour-tile"},null,8,["time","specialist"])):J("",!0),_("div",{class:"schedule-column__cursor",onClick:C,onDblclick:M,onMousemove:P,onMouseleave:T},null,32)],4)])}}});export{xe as _,ze as a,Be as b};
