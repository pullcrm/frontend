var R=Object.defineProperty;var F=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var $=(n,i,a)=>i in n?R(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a,_=(n,i)=>{for(var a in i||(i={}))W.call(i,a)&&$(n,a,i[a]);if(F)for(var a of F(i))X.call(i,a)&&$(n,a,i[a]);return n};import{a4 as j,k as T,Q as w,aY as J,aG as s,ay as x,U as K,b1 as l,a2 as e,X as M,x as V,W as Z,I as uu,V as eu,bp as tu,a1 as y}from"./index.53588f62.js";import{u as ou}from"./schedule.da7e5da2.js";import{u as au}from"./timetable.70b57e2e.js";import{u as lu}from"./specialists.56f430f2.js";import{V as C,a as iu,u as su}from"./index.e6dcdd48.js";import{s as g}from"./time.8571a5e6.js";import{_ as nu}from"./DatePicker.06e76f12.js";import{api as mu}from"./api.50e126cb.js";import{f as ru}from"./date-time.d466b3fd.js";import"./base.686dbe64.js";import"./dayjs.228bf609.js";import"./isTomorrow.a3ceb101.js";import"./_commonjsHelpers.2cf1d77b.js";import"./toasts.113f48d8.js";import"./roles.61f7d6b9.js";const du=y(" \u0417\u0430\u043A\u0440\u0438\u0442\u0438 \u0437\u0430\u043F\u0438\u0441 "),pu=["onSubmit"],cu=y(" \u0417\u0430\u043A\u0440\u0438\u0442\u0438 \u0437\u0430\u043F\u0438\u0441 \u043D\u0430 \u0432\u0435\u0441\u044C \u0434\u0435\u043D\u044C "),fu={class:"time-off-new-popup__actions"},vu=y(" \u0414\u043E\u0434\u0430\u0442\u0438 "),Mu=j({name:"New",props:{specialistId:{type:Number,default:null},time:{type:String,default:null}},emits:["close"],setup(n,{emit:i}){const a=n,B=ou(),Y=au(),S=lu(),b=T(!1),r=T(!1),t=T({endTime:"",startTime:a.time,specialist:a.specialistId&&S.specialists.find(({id:m})=>m===a.specialistId),description:""}),f=T(new Date(B.date)),d=w(()=>Y.workingHours),I=w(()=>{if(!t.value.startTime)return[];const m=d.value.indexOf(t.value.startTime);return d.value.filter((u,v)=>m<v)}),N={specialist:_({},C("\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u0441\u043F\u0435\u0446\u0456\u0430\u043B\u0456\u0441\u0442\u0430")),startTime:!r.value&&_({},C("\u0412\u043A\u0430\u0436\u0456\u0442\u044C \u0447\u0430\u0441 \u043F\u043E\u0447\u0430\u0442\u043A\u0443")),endTime:!r.value&&_({},C("\u0412\u043A\u0430\u0436\u0456\u0442\u044C \u0447\u0430\u0441 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u044F")),description:_({},iu("\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u0430 \u043A\u0456\u043B\u044C\u043A\u0456\u0441\u0442\u044C \u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432: 255",255))},A=su(N,t),H=w(()=>S.specialists);async function h(){if(!!await A.$validate())try{b.value=!0;const u=g(f.value,t.value.endTime).format("YYYY-MM-DD HH:mm:ss"),v=g(f.value,t.value.startTime).format("YYYY-MM-DD HH:mm:ss");await mu.timeOff.create({specialistId:t.value.specialist.id,endDateTime:u,startDateTime:v,description:t.value.description}),await B.fetchTimeOffs(),z()}finally{b.value=!1}}async function z(){i("close")}return J(()=>r.value,m=>{m&&(t.value.endTime=d.value[d.value.length-1],t.value.startTime=d.value[0])}),(m,u)=>{const v=s("UiBack"),E=s("UiTitle"),D=s("UiSelect"),p=s("UiField"),k=s("UiInput"),q=s("UiPopover"),P=s("UiText"),O=s("UiSwitch"),L=s("UiButton"),G=s("UiFormValidator"),Q=s("UiPopup");return x(),K(Q,{class:"time-off-new-popup",onClose:u[7]||(u[7]=c=>m.$emit("close"))},{default:l(()=>[e(v,{onBack:u[0]||(u[0]=c=>m.$emit("close"))}),e(E,{class:"time-off-new-popup__title",size:"s"},{default:l(()=>[du]),_:1}),M("form",{onSubmit:tu(h,["prevent"])},[e(G,{validate:V(A)},{default:l(({resetFieldError:c,getFieldError:U})=>[e(p,{label:"\u0421\u043F\u0435\u0446\u0456\u0430\u043B\u0456\u0441\u0442",required:"",error:U("specialist")},{default:l(()=>[e(D,{modelValue:t.value.specialist,"onUpdate:modelValue":[u[1]||(u[1]=o=>t.value.specialist=o),o=>c("specialist")],options:V(H),"label-key":"fullName",placeholder:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0441\u043F\u0435\u0446\u0456\u0430\u043B\u0456\u0441\u0442\u0430",clearable:!1},null,8,["modelValue","options","onUpdate:modelValue"])]),_:2},1032,["error"]),e(q,{class:"time-off-new-popup__popover",size:"m",placement:"bottom_start"},{body:l(()=>[e(nu,{modelValue:f.value,"onUpdate:modelValue":u[2]||(u[2]=o=>f.value=o)},null,8,["modelValue"])]),default:l(()=>[e(p,{label:"\u0414\u0430\u0442\u0430"},{default:l(()=>[e(k,{readonly:"","left-icon":"outlined/calendar-blank","model-value":V(ru)(f.value,"D MMMM")},null,8,["model-value"])]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(O,{modelValue:r.value,"onUpdate:modelValue":u[3]||(u[3]=o=>r.value=o),size:"m"},{append:l(()=>[e(P,{size:"m"},{default:l(()=>[cu]),_:1})]),_:1},8,["modelValue"])]),_:1}),r.value===!1?(x(),Z(uu,{key:0},[e(p,{label:"\u0427\u0430\u0441 \u043F\u043E\u0447\u0430\u0442\u043A\u0443",required:"",error:U("startTime")},{default:l(()=>[e(D,{modelValue:t.value.startTime,"onUpdate:modelValue":[u[4]||(u[4]=o=>t.value.startTime=o),o=>c("startTime")],options:V(d),placeholder:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0447\u0430\u0441 \u043F\u043E\u0447\u0430\u0442\u043A\u0443"},null,8,["modelValue","options","onUpdate:modelValue"])]),_:2},1032,["error"]),e(p,{label:"\u0427\u0430\u0441 \u0437\u0430\u043A\u0456\u043D\u0447\u0435\u043D\u043D\u044F",required:"",error:U("endTime")},{default:l(()=>[e(D,{modelValue:t.value.endTime,"onUpdate:modelValue":[u[5]||(u[5]=o=>t.value.endTime=o),o=>c("endTime")],options:V(I),placeholder:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0447\u0430\u0441 \u0437\u0430\u043A\u0456\u043D\u0447\u0435\u043D\u043D\u044F"},null,8,["modelValue","options","onUpdate:modelValue"])]),_:2},1032,["error"])],64)):eu("",!0),e(p,{label:"\u041A\u043E\u0440\u043E\u0442\u043A\u0438\u0439 \u043E\u043F\u0438\u0441",error:U("description")},{default:l(()=>[e(k,{modelValue:t.value.description,"onUpdate:modelValue":[u[6]||(u[6]=o=>t.value.description=o),o=>c("description")],tag:"textarea",placeholder:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043E\u043F\u0438\u0441"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["error"]),M("div",fu,[e(L,{type:"submit",size:"l",theme:"blue",loading:b.value},{default:l(()=>[vu]),_:1},8,["loading"])])]),_:1},8,["validate"])],40,pu)]),_:1})}}});export{Mu as default};
