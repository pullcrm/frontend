var N=Object.defineProperty;var b=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var C=(a,e,u)=>e in a?N(a,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):a[e]=u,d=(a,e)=>{for(var u in e||(e={}))P.call(e,u)&&C(a,u,e[u]);if(b)for(var u of b(e))$.call(e,u)&&C(a,u,e[u]);return a};import{a4 as q,bx as A,bD as R,k as T,r as z,as as L,aG as r,ay as y,U as E,b1 as n,X as U,a2 as s,a1 as c,D as M,V as G,x as X,bp as j}from"./index.53588f62.js";import{u as H}from"./quasar.esm.prod.7cf60e50.js";import{u as J,a as K,b as O}from"./base.686dbe64.js";import{V as B,b as Q,u as W}from"./index.e6dcdd48.js";import{_ as Y}from"./Layout.ed4dcc8e.js";import{g as Z}from"./format-phone.df9e2fd4.js";import"./logo.0179c6cf.js";const uu=["onSubmit"],eu=c(" \u0412\u0456\u0434\u043D\u043E\u0432\u0438\u0442\u0438 \u0434\u043E\u0441\u0442\u0443\u043F "),ou={class:"auth-page-login__actions"},tu=c(" \u0423\u0432\u0456\u0439\u0442\u0438 "),au=c(" \u0420\u0435\u0454\u0441\u0442\u0440\u0430\u0446\u0456\u044F "),mu=q({name:"Login",setup(a){H({title:"\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0456\u044F - pullcrm"});const e=A(),u=R(),m=J(),D=K(),_=O(),i=T(null),o=z({phone:"",password:""}),F={phone:d(d({},B("\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0443")),Q("\u041D\u0435 \u0432\u0456\u0440\u043D\u0438\u0439 \u0444\u043E\u0440\u043C\u0430\u0442 \u043D\u043E\u043C\u0435\u0440\u0443")),password:d({},B("\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043F\u0430\u0440\u043E\u043B\u044C"))},h=W(F,o);L(()=>{const{phone:p}=e.query;p&&(o.phone=String(p))});const S=async()=>{if(!!await h.$validate())try{if(await m.login({phone:Z(o.phone),password:o.password}),await D.fetchProfile(),_.hasPositions){const t=_.positions[0];await m.refreshTokenByPosition(t),u.push({name:"dashboard"});return}await u.push({name:"companyCreate"})}catch(t){if(t.fieldName){i.value=t;return}throw t}};return(p,t)=>{const f=r("UiInput"),g=r("UiField"),x=r("UiText"),k=r("UiAlert"),v=r("UiButton"),I=r("UiFormValidator");return y(),E(Y,{title:"\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0456\u044F","sub-title":"\u0423\u0432\u0456\u0439\u0434\u0456\u0442\u044C \u0443 \u0441\u0438\u0441\u0442\u0435\u043C\u0443, \u0449\u043E\u0431 \u043E\u0442\u0440\u0438\u043C\u0430\u0442\u0438 \u0434\u043E\u0441\u0442\u0443\u043F \u0434\u043E \u0441\u0432\u043E\u0454\u0457 \u043A\u043E\u043C\u043F\u0430\u043D\u0456\u0457",class:"auth-page-login"},{default:n(()=>[U("form",{onSubmit:j(S,["prevent"])},[s(I,{validate:X(h)},{default:n(({resetFieldError:w,getFieldError:V})=>[s(g,{label:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",error:V("phone")},{default:n(()=>[s(f,{modelValue:o.phone,"onUpdate:modelValue":t[0]||(t[0]=l=>o.phone=l),mask:"+38 (###) #### ###",type:"phone",name:"phone",inputmode:"tel","left-icon":"outlined/phone",placeholder:"066",autocomplete:"on",onInput:l=>(i.value=null,w("phone"))},null,8,["modelValue","onInput"])]),_:2},1032,["error"]),s(g,{label:"\u041F\u0430\u0440\u043E\u043B\u044C",error:V("password")},{default:n(()=>[s(f,{modelValue:o.password,"onUpdate:modelValue":t[1]||(t[1]=l=>o.password=l),type:"password",name:"password","left-icon":"outlined/key",placeholder:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043F\u0430\u0440\u043E\u043B\u044C",autocomplete:"on",onInput:l=>(i.value=null,w("password"))},null,8,["modelValue","onInput"])]),_:2},1032,["error"]),s(x,{tag:"RouterLink",to:{name:"restore",query:{phone:o.phone}},size:"s",class:"auth-page-login__reset"},{default:n(()=>[eu]),_:1},8,["to"]),i.value?(y(),E(k,{key:0,theme:"error","left-icon":"solid/warning-circle-fill",class:"auth-page-login__error"},{default:n(()=>[c(M(i.value.message),1)]),_:1})):G("",!0),U("div",ou,[s(v,{type:"submit",size:"l",theme:"blue"},{default:n(()=>[tu]),_:1}),s(v,{to:{name:"registration",query:{phone:o.phone}},type:"submit",size:"l",theme:"info-outlined"},{default:n(()=>[au]),_:1},8,["to"])])]),_:1},8,["validate"])],40,uu)]),_:1})}}});export{mu as default};
