import{u as J}from"./quasar.esm.prod.7cf60e50.js";import{by as Z,af as L,bC as ee,bE as te,Q as s,ac as se,a9 as ne,a4 as T,bD as N,aG as h,ay as d,W as k,a2 as t,x as l,f as ae,X as D,b1 as i,A as E,bp as A,a1 as g,I as V,aE as F,U as $,D as P,V as I,k as O,as as Q,ao as oe,C as ue,bs as ie,aA as ce,bx as re}from"./index.53588f62.js";import{u as W}from"./popup.f1b7e5e0.js";import{u as M,a as Y,I as le,i as _e,C as pe}from"./schedule.da7e5da2.js";import{a as de}from"./render.5e4deb99.js";import{u as H}from"./timetable.70b57e2e.js";import"./dayjs.228bf609.js";import{_ as me}from"./DatePicker.06e76f12.js";import{d as C}from"./isTomorrow.a3ceb101.js";import{_ as fe,a as he,b as ve}from"./Column.04cdc3e6.js";import{u as ye}from"./specialists.56f430f2.js";import{p as ge,s as w}from"./time.8571a5e6.js";import{f as De}from"./money.dd3f296a.js";import{api as be}from"./api.50e126cb.js";import{S as ke}from"./Loader.55629d1d.js";import"./date-time.d466b3fd.js";import"./base.686dbe64.js";import"./_commonjsHelpers.2cf1d77b.js";import"./toasts.113f48d8.js";import"./index.ca9f222c.js";import"./roles.61f7d6b9.js";var Se=Z({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(v,{slots:o}){const{proxy:{$q:n}}=ne(),e=L(ee);L(te,()=>{console.error("QPage needs to be child of QPageContainer")});const u=s(()=>{const a=(e.header.space===!0?e.header.size:0)+(e.footer.space===!0?e.footer.size:0);if(typeof v.styleFn=="function"){const c=e.isContainer.value===!0?e.containerHeight.value:n.screen.height;return v.styleFn(a,c)}return{minHeight:e.isContainer.value===!0?e.containerHeight.value-a+"px":n.screen.height===0?a!==0?`calc(100vh - ${a}px)`:"100vh":n.screen.height-a+"px"}}),_=s(()=>`q-page ${v.padding===!0?" q-layout-padding":""}`);return()=>se("main",{class:_.value,style:u.value},de(o.default))}});const xe={class:"schedule-page-queue-schedule-date-picker"},Ce={class:"schedule-page-queue-schedule-date-picker__footer"},$e=g(" \u0421\u044C\u043E\u0433\u043E\u0434\u043D\u0456 "),Te=g(" \u0417\u0430\u0432\u0442\u0440\u0430 "),j=T({name:"ScheduleDatePicker",emits:["input"],setup(v){const o=N(),n=M(),e=H(),u=s({get(){return new Date(n.date)},set(m){const r=C(m).format("YYYY-MM-DD");o.replace({query:{date:r}}),n.date=r,n.fetch()}}),_=s(()=>C(u.value).isToday()),a=s(()=>C(u.value).isTomorrow());s(()=>e.normalizeTimetable);function c(){_.value||(u.value=new Date)}function p(){a.value||(u.value=C().add(1,"day").toDate())}return(m,r)=>{const y=h("UiText");return d(),k("div",xe,[t(me,{modelValue:l(u),"onUpdate:modelValue":r[0]||(r[0]=S=>ae(u)?u.value=S:null),class:"schedule-page-queue-schedule-date-picker__date-picker"},null,8,["modelValue"]),D("div",Ce,[t(y,{tag:"a",href:"#",size:"m",class:E(["schedule-page-queue-schedule-date-picker__button",{active:l(_)}]),"data-test":"date-picker-today",onClick:A(c,["prevent"])},{default:i(()=>[$e]),_:1},8,["class","onClick"]),t(y,{tag:"a",href:"#",size:"m",class:E(["schedule-page-queue-schedule-date-picker__button",{active:l(a)}]),"data-test":"date-picker-tomorrow",onClick:A(p,["prevent"])},{default:i(()=>[Te]),_:1},8,["class","onClick"])])])}}});const Ue={class:"schedule-page-sidebar"},we={class:"schedule-page-sidebar__inner"},ze=g(" \u0427\u0435\u0440\u0433\u0430 "),Be=g(" \u0414\u043E\u0434\u0430\u0442\u0438 \u0432 \u0447\u0435\u0440\u0433\u0443 "),Pe=T({name:"Sidebar",setup(v){const o=W(),n=Y(),e=s(()=>n.queue);function u(){o.show({name:"appointment",props:{type:"new",defaultStatus:le}})}function _(a){o.show({name:"appointment",props:{type:"edit",appointment:a}})}return(a,c)=>{const p=h("UiTitle"),m=h("UiText");return d(),k("div",Ue,[D("div",we,[t(j,{class:"schedule-page-sidebar__schedule-date-picker"}),t(p,{size:"s",class:"schedule-page-sidebar__title"},{default:i(()=>[ze]),_:1}),(d(!0),k(V,null,F(l(e),r=>(d(),$(fe,{key:`queue-${r.id}`,appointment:r,class:"schedule-page-sidebar__appointment",onOpen:_},null,8,["appointment"]))),128)),D("div",{class:"schedule-page-sidebar__action",onClick:u},[t(m,{size:"l",responsive:"","left-icon":"outlined/note-pencil"},{default:i(()=>[Be]),_:1})])])])}}});const Ae=T({name:"DatePickerButton",setup(v){return(o,n)=>{const e=h("UiButton"),u=h("UiPopover");return d(),$(u,{size:"m",placement:"top_end",class:"schedule-page-date-picker-button"},{body:i(({close:_})=>[t(j,{onInput:_},null,8,["onInput"])]),default:i(()=>[t(e,{class:"schedule-page-date-picker-button__button",size:"l",theme:"blue","left-icon":"outlined/calendar"})]),_:1})}}});const Ie={class:"schedule-column-specialist__info"},Me=D("span",null," - ",-1),qe=g(" \u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 "),Ee=g(" \u0417\u0430\u043A\u0440\u0438\u0442\u0438 \u0437\u0430\u043F\u0438\u0441 "),Oe=D("br",null,null,-1),Ye=g(" \u043D\u0430 \u0446\u0435\u0439 \u0434\u0435\u043D\u044C "),He=T({name:"Specialist",props:{specialist:{type:Object,required:!0}},setup(v){const o=v,n=N(),e=M(),u=H(),_=Y(),a=s(()=>o.specialist.status),c=s(()=>o.specialist.user),p=s(()=>{var f;return(f=c.value.avatar)==null?void 0:f.path}),m=s(()=>e.timeOffs),r=s(()=>u.timeWork),y=s(()=>m.value.some(f=>f.specialistId!==o.specialist.id?!1:_e(f,r.value))),S=s(()=>_.appointments.filter(({specialist:f})=>f.id===o.specialist.id)),b=s(()=>S.value.length),x=s(()=>S.value.filter(({status:f})=>f===pe).reduce((f,{total:z})=>f+z,0));async function R(){const{from:f,to:z}=r.value,B=new Date(e.date),U=w(B,f).format("YYYY-MM-DD HH:mm:ss"),q=w(B,z).format("YYYY-MM-DD HH:mm:ss");await be.timeOff.create({specialistId:o.specialist.id,endDateTime:q,startDateTime:U,description:""}),await e.fetchTimeOffs()}async function K(){await n.push({name:"specialistInfo",params:{slug:o.specialist.id}})}return(f,z)=>{const B=h("UiAvatar"),U=h("UiText"),q=h("UiIcon"),G=h("UiDropdownList"),X=h("UiDropdownMenu");return d(),k("div",{class:E(["schedule-column-specialist",[`_status_${l(a)}`]])},[t(B,{class:"schedule-column-specialist__avatar",image:l(p),name:l(c).fullName,size:"s"},null,8,["image","name"]),D("div",Ie,[t(U,{class:"schedule-column-specialist__name",size:"s"},{default:i(()=>[g(P(l(c).fullName),1)]),_:1}),t(U,{class:"schedule-column-specialist__total",size:"s"},{default:i(()=>[g(P(l(b))+" "+P(l(ge)(l(b),"\u043A\u043B\u0456\u0454\u043D\u0442","\u043A\u043B\u0456\u0454\u043D\u0442\u0430","\u043A\u043B\u0456\u0454\u043D\u0442\u0456\u0432"))+" ",1),Me,g(" "+P(l(De)(l(x))),1)]),_:1})]),t(X,{placement:"bottom_end"},{inner:i(()=>[t(q,{class:"schedule-column-specialist__icon",size:"s",name:"outlined/dots-three-vertical"})]),default:i(()=>[t(G,null,{default:i(()=>[t(U,{tag:"a",href:"#",size:"m","left-icon":"outlined/pencil",onClick:A(K,["prevent"])},{default:i(()=>[qe]),_:1},8,["onClick"]),l(y)===!1?(d(),$(U,{key:0,tag:"a",href:"#",size:"m","left-icon":"outlined/prohibit",onClick:A(R,["prevent"])},{default:i(()=>[Ee,Oe,Ye]),_:1},8,["onClick"])):I("",!0)]),_:1})]),_:1})],2)}}});const Le={key:0,class:"schedule-active-time"},Ne=["data-time"],Ve=T({name:"ActiveTime",setup(v){const n=O(0),e=O(null),u=H(),_=s(()=>u.timeWork);Q(()=>{const{from:c,to:p}=_.value;a(c,p);const m=setInterval(()=>a(c,p),6e4);oe(()=>{clearInterval(m)})});function a(c,p){const m=(w(new Date,p).unix()-w(new Date,c).unix())/60,r=(C(new Date).unix()-w(new Date,c).unix())/60;if(n.value=r*100/m,n.value<0||n.value>100){e.value=null;return}e.value=C(new Date).format("HH:mm")}return(c,p)=>e.value?(d(),k("div",Le,[D("div",{class:"schedule-active-time__inner",style:ue(`top: ${n.value}%;`),"data-time":e.value},null,12,Ne)])):I("",!0)}});const Fe={},Qe={class:"schedule-column-placeholder"};function We(v,o){return d(),k("div",Qe)}var je=ie(Fe,[["render",We]]);const Re={class:"schedule"},Ke={class:"schedule__columns"},Ge=T({name:"Schedule",props:{loading:{type:Boolean,default:!1}},setup(v){const o=O(null);ce("getUiTooltipContainer",()=>o.value);const n=M(),e=ye(),u=Y(),_=s(()=>n.date),a=s(()=>C(_.value).isToday()),c=s(()=>e.specialists),p=s(()=>n.normalizeTimeOffs),m=s(()=>u.appointments),r=s(()=>c.value.filter(({status:y})=>y!=="HIDE").map(y=>{const S=m.value.filter(x=>x.specialist.id===y.id);return{timeOffs:p.value.filter(({specialistId:x})=>x===y.id),specialist:y,appointments:S}}));return(y,S)=>(d(),k("div",Re,[t(he,{class:"schedule__timeline"}),l(a)?(d(),$(Ve,{key:0})):I("",!0),D("div",{ref_key:"inner",ref:o,class:"schedule__inner"},[v.loading?(d(),$(ke,{key:0})):I("",!0),D("div",Ke,[(d(!0),k(V,null,F(l(r),(b,x)=>(d(),$(ve,{key:`column-${x}`,class:"schedule__column","time-offs":b.timeOffs,specialist:b.specialist,appointments:b.appointments},{append:i(()=>[t(He,{class:"schedule__specialist",specialist:b.specialist},null,8,["specialist"])]),_:2},1032,["time-offs","specialist","appointments"]))),128)),t(je)])],512)]))}});const Xe={class:"schedule-page__header"},Je=g(" \u041A\u0430\u043B\u0435\u043D\u0434\u0430\u0440 "),Ze=g(" \u0414\u043E\u0434\u0430\u0442\u0438 \u0437\u0430\u043F\u0438\u0441 "),bt=T({name:"SchedulePage",setup(v){J({title:"\u041A\u0430\u043B\u0435\u043D\u0434\u0430\u0440 - pullcrm"});const o=re(),n=W(),e=M(),u=s(()=>e.isLoading);Q(async()=>{const{date:a}=o.query;a&&(e.date=String(a)),await e.fetch()});async function _(){await n.show({name:"appointment",props:{type:"new"}})}return(a,c)=>{const p=h("UiTitle"),m=h("UiButton"),r=h("UiContainer"),y=h("Portal");return d(),$(Se,{class:"schedule-page"},{default:i(()=>[t(r,null,{default:i(()=>[D("div",Xe,[t(p,{size:"m",responsive:""},{default:i(()=>[Je]),_:1}),t(m,{size:"s",theme:"blue","right-icon":"outlined/plus",onClick:_},{default:i(()=>[Ze]),_:1})]),t(Ge,{class:"schedule-page__schedule",loading:l(u)},null,8,["loading"])]),_:1}),t(Ae,{class:"schedule-page__date-picker-button"}),t(y,{to:"sidebar"},{default:i(()=>[t(Pe)]),_:1})]),_:1})}}});export{bt as default};
