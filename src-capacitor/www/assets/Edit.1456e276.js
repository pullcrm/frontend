var O=Object.defineProperty,G=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var h=(i,t,a)=>t in i?O(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a,s=(i,t)=>{for(var a in t||(t={}))X.call(t,a)&&h(i,a,t[a]);if(I)for(var a of I(t))j.call(t,a)&&h(i,a,t[a]);return i},x=(i,t)=>G(i,Q(t));import{a4 as H,k as b,Q as y,aG as d,ay as J,U as K,b1 as r,a2 as o,X as F,x as f,f as W,bp as Y,a1 as A}from"./index.53588f62.js";import{u as Z}from"./procedures.f7d5b6cf.js";import{u as uu}from"./specialists.56f430f2.js";import{V as D,c as eu,a as P,e as ou,f as tu,u as au}from"./index.e6dcdd48.js";import{api as lu}from"./api.50e126cb.js";import{P as iu}from"./time.50f2cb44.js";import{m as k}from"./time.8571a5e6.js";import"./base.686dbe64.js";import"./toasts.113f48d8.js";import"./roles.61f7d6b9.js";import"./_commonjsHelpers.2cf1d77b.js";import"./dayjs.228bf609.js";import"./isTomorrow.a3ceb101.js";const nu=A(" \u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u043F\u043E\u0441\u043B\u0443\u0433\u0443 "),su=["onSubmit"],ru={class:"procedures-edit__actions"},du=A(" \u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u043F\u043E\u0441\u043B\u0443\u0433\u0443 "),pu=A(" \u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438 \u043F\u043E\u0441\u043B\u0443\u0433\u0443 "),Su=H({name:"Edit",props:{procedure:null},emits:["close"],setup(i,{emit:t}){const a=i,v=Z(),_=uu(),p=b(!1),l=b(s({},a.procedure)),C=b([]);C.value=_.specialists.filter(({procedures:n})=>n.some(({id:u})=>u===a.procedure.id));const B=y({get(){return k(l.value.duration)},set(n){var u;l.value.duration=(u=n==null?void 0:n.value)!=null?u:""}}),w=y(()=>iu.map(n=>({name:k(n),value:n}))),M=y(()=>v.categories),T={name:s(s(s({},D("\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043D\u0430\u0437\u0432\u0443 \u043F\u043E\u0441\u043B\u0443\u0433\u0438")),eu("\u041C\u0456\u043D\u0456\u043C\u0430\u043B\u044C\u043D\u0430 \u043A\u0456\u043B\u044C\u043A\u0456\u0441\u0442\u044C \u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432: 4",4)),P("\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u0430 \u043A\u0456\u043B\u044C\u043A\u0456\u0441\u0442\u044C \u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432: 255",255)),price:s(s(s({},D("\u0412\u043A\u0430\u0436\u0456\u0442\u044C \u0446\u0456\u043D\u0443")),ou("\u041C\u0456\u043D\u0456\u043C\u0430\u043B\u044C\u043D\u0430 \u0446\u0456\u043D\u0430: 0",0)),tu("\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u0430 \u0446\u0456\u043D\u0430: 99999",99999)),duration:s({},D("\u0412\u043A\u0430\u0436\u0456\u0442\u044C \u0442\u0440\u0438\u0432\u0430\u043B\u0456\u0441\u0442\u044C \u043F\u043E\u0441\u043B\u0443\u0433\u0438")),description:s({},P("\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u0430 \u043A\u0456\u043B\u044C\u043A\u0456\u0441\u0442\u044C \u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432: 255",255))},g=au(T,l);async function N(){if(!!await g.$validate())try{p.value=!0,await v.updateProcedure(x(s({},l.value),{specialistIds:C.value.map(({id:u})=>u)})),await Promise.all([v.fetch(),_.fetch()]),t("close")}finally{p.value=!1}}async function R(){try{p.value=!0,await lu.procedures.remove(l.value.id),await Promise.all([v.fetch(),_.fetch()]),t("close")}finally{p.value=!1}}return(n,u)=>{const $=d("UiTitle"),U=d("UiInput"),c=d("UiField"),S=d("UiSelect"),q=d("UiMultiSelect"),E=d("UiButton"),L=d("UiFormValidator"),z=d("UiPopup");return J(),K(z,{class:"procedures-edit",onClose:u[6]||(u[6]=m=>n.$emit("close"))},{default:r(()=>[o($,{class:"procedures-edit__title",size:"s"},{default:r(()=>[nu]),_:1}),F("form",{onSubmit:Y(N,["prevent"])},[o(L,{validate:f(g)},{default:r(({resetFieldError:m,getFieldError:V})=>[o(c,{label:"\u041D\u0430\u0437\u0432\u0430 \u043F\u043E\u0441\u043B\u0443\u0433\u0438",error:V("name"),required:""},{default:r(()=>[o(U,{modelValue:l.value.name,"onUpdate:modelValue":u[0]||(u[0]=e=>l.value.name=e),"left-icon":"outlined/pencil",placeholder:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043D\u0430\u0437\u0432\u0443",onInput:e=>m("name")},null,8,["modelValue","onInput"])]),_:2},1032,["error"]),o(c,{label:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0456\u044F"},{default:r(()=>[o(S,{modelValue:l.value.category,"onUpdate:modelValue":[u[1]||(u[1]=e=>l.value.category=e),e=>m("category")],"label-key":"name",options:f(M),placeholder:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0456\u044E"},null,8,["modelValue","options","onUpdate:modelValue"])]),_:2},1024),o(c,{label:"\u0426\u0456\u043D\u0430",error:V("price"),required:""},{default:r(()=>[o(U,{modelValue:l.value.price,"onUpdate:modelValue":u[2]||(u[2]=e=>l.value.price=e),type:"number","left-icon":"outlined/pencil",placeholder:"\u0412\u043A\u0430\u0436\u0456\u0442\u044C \u0446\u0456\u043D\u0443",onInput:e=>m("price")},null,8,["modelValue","onInput"])]),_:2},1032,["error"]),o(c,{label:"\u0422\u0440\u0438\u0432\u0430\u043B\u0456\u0441\u0442\u044C",error:V("duration"),required:""},{default:r(()=>[o(S,{modelValue:f(B),"onUpdate:modelValue":[u[3]||(u[3]=e=>W(B)?B.value=e:null),e=>m("duration")],"label-key":"name",options:f(w),clearable:!1,"left-icon":"outlined/pencil",placeholder:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0447\u0430\u0441"},null,8,["modelValue","options","onUpdate:modelValue"])]),_:2},1032,["error"]),o(c,{label:"\u0421\u043F\u0435\u0446\u0456\u0430\u043B\u0456\u0441\u0442\u0438"},{default:r(()=>[o(q,{modelValue:C.value,"onUpdate:modelValue":u[4]||(u[4]=e=>C.value=e),options:f(_).specialists,"label-key":"fullName",placeholder:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0441\u043F\u0435\u0446\u0456\u0430\u043B\u0456\u0441\u0442\u0456\u0432"},null,8,["modelValue","options"])]),_:1}),o(c,{label:"\u041E\u043F\u0438\u0441",error:V("description")},{default:r(()=>[o(U,{modelValue:l.value.description,"onUpdate:modelValue":u[5]||(u[5]=e=>l.value.description=e),tag:"textarea",name:"description",placeholder:"\u0414\u043E\u0431\u0430\u0432\u0442\u0435 \u043E\u043F\u0438\u0441",onInput:e=>m("description")},null,8,["modelValue","onInput"])]),_:2},1032,["error"]),F("div",ru,[o(E,{type:"submit",size:"m",theme:"blue",loading:p.value},{default:r(()=>[du]),_:1},8,["loading"]),o(E,{size:"m",theme:"danger-outlined",class:"procedures-edit__remove",loading:p.value,onClick:R},{default:r(()=>[pu]),_:1},8,["loading"])])]),_:1},8,["validate"])],40,su)]),_:1})}}});export{Su as default};
