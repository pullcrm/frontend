var I=Object.defineProperty;var X=(s,t,e)=>t in s?I(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var y=(s,t,e)=>(X(s,typeof t!="symbol"?t+"":t,e),e);import{u as N}from"./quasar.esm.prod.7cf60e50.js";import{u as j}from"./toasts.113f48d8.js";import{u as B}from"./analytics.16c9d535.js";import{_ as L}from"./InfoPanel.49feab07.js";import{a4 as z,Q as f,aG as $,ay as _,W as d,X as D,a2 as l,b1 as u,a1 as h,D as g,x as v,A as E,k as M,aA as H,I as x,aE as A,C as w,U as P,aF as R,f as W}from"./index.53588f62.js";import"./dayjs.228bf609.js";import{d as C}from"./isTomorrow.a3ceb101.js";import{_ as q}from"./DatePicker.06e76f12.js";import{f as k}from"./date-time.d466b3fd.js";import"./_commonjsHelpers.2cf1d77b.js";const G={class:"analytics-appointments-page-numbers"},K={class:"ui-grid"},Q=h(" \u0412\u0441\u044C\u043E\u0433\u043E \u0437\u0430\u043F\u0438\u0441\u0456\u0432 "),J=h(" \u0412\u0438\u043A\u043E\u043D\u0430\u043D\u043E "),O=h(" \u041E\u0444\u043B\u0430\u0439\u043D "),Z=h(" \u041E\u043D\u043B\u0430\u0439\u043D "),tt=z({name:"Numbers",setup(s){const t=B(),e=f(()=>t.appointmentsStats),a=f(()=>e.value.total),i=f(()=>e.value.completed),n=f(()=>e.value.offline),r=f(()=>e.value.online);return(p,m)=>{const o=$("UiText"),c=$("UiTitle");return _(),d("div",G,[D("div",K,[l(L,{class:E(["ui-grid-item","ui-grid-item_12","ui-grid-item_tablet_6","ui-grid-item_laptop_3"]),theme:"blue",icon:"solid/list",info:"\u0412\u043A\u043B\u044E\u0447\u0430\u044E\u0447\u0438 \u043D\u0435\u0432\u0438\u043A\u043E\u043D\u0430\u043D\u0456 \u0442\u0430 \u0441\u043A\u0430\u0441\u043E\u0432\u0430\u043D\u0456"},{default:u(()=>[l(o,{size:"m",responsive:""},{default:u(()=>[Q]),_:1}),l(c,{size:"s",responsive:""},{default:u(()=>[h(g(v(a)),1)]),_:1})]),_:1}),l(L,{class:E(["ui-grid-item","ui-grid-item_12","ui-grid-item_tablet_6","ui-grid-item_laptop_3"]),theme:"green",icon:"solid/check-circle-fill",info:"\u0422\u0456\u043B\u044C\u043A\u0438 \u043E\u043F\u043B\u0430\u0447\u0435\u043D\u0456"},{default:u(()=>[l(o,{size:"m",responsive:""},{default:u(()=>[J]),_:1}),l(c,{size:"s",responsive:""},{default:u(()=>[h(g(v(i)),1)]),_:1})]),_:1}),l(L,{class:E(["ui-grid-item","ui-grid-item_12","ui-grid-item_tablet_6","ui-grid-item_laptop_3"]),theme:"yellow",icon:"solid/device-mobile-camera-fill",info:"\u0421\u0442\u0432\u043E\u0440\u0435\u043D\u0456 \u043C\u0435\u043D\u0435\u0434\u0436\u0435\u0440\u043E\u043C \u0447\u0435\u0440\u0435\u0437 \u0430\u0434\u043C\u0456\u043D\u043A\u0443"},{default:u(()=>[l(o,{size:"m",responsive:""},{default:u(()=>[O]),_:1}),l(c,{size:"s",responsive:""},{default:u(()=>[h(g(v(n)),1)]),_:1})]),_:1}),l(L,{class:E(["ui-grid-item","ui-grid-item_12","ui-grid-item_tablet_6","ui-grid-item_laptop_3"]),theme:"purple",icon:"outlined/globe",info:"\u0421\u0442\u0432\u043E\u0440\u0435\u043D\u0456 \u0447\u0435\u0440\u0435\u0437 \u0432\u0456\u0434\u0436\u0435\u0442"},{default:u(()=>[l(o,{size:"m",responsive:""},{default:u(()=>[Z]),_:1}),l(c,{size:"s",responsive:""},{default:u(()=>[h(g(v(r)),1)]),_:1})]),_:1})])])}}});function et(s,t,e){return(s-t)/(e-t)}function Y(s,t,e){if(t===e)return s.map(({value:i,label:n,info:r})=>({info:r,label:n,ratio:1/2,value:i,valueDifference:0}));let a;return s.map(({value:i,label:n,info:r})=>{const p={info:r,label:n,value:i,ratio:et(i,t,e),valueDifference:i-(a!=null?a:i)};return a=i,p})}class it{constructor(t,e){y(this,"values",[]);y(this,"options");y(this,"paddingX",24);y(this,"paddingY",0);y(this,"_points",null);y(this,"_curves",null);y(this,"_splitCurves",null);y(this,"_valueLinesPoints",null);this.values=t,this.options=e}get points(){const t=this.options.width-this.paddingX*2,e=this.options.height-this.paddingY*2;return this._points=this._points||Y(this.values,this.minAvailableLine,this.maxAvailableLine).map(({ratio:a,label:i,value:n,valueDifference:r,info:p},m)=>{const o=this.paddingX+t/(this.values.length-1)*m,c=this.paddingY+(e-e*a);return{x:o,y:c,info:p,label:i,value:n,valueDifference:r}}),this._points}get splitCurves(){this._splitCurves=this._splitCurves||this.points.slice(0,-1).map((a,i)=>{const{x:n,y:r}=this.points[i],{x:p,y:m}=this.points[i+1];return`L${n} ${r} ${p} ${m}`});const t=this.points[0],e=this.points[this.points.length-1];return[`M${t.x} ${this.options.height}`,...this._splitCurves,`L${e.x} ${this.options.height}`].join(" ")}get curves(){return this._curves=this._curves||this.points.slice(0,-1).map((t,e)=>{const{x:a,y:i,value:n}=this.points[e],{x:r,y:p,value:m}=this.points[e+1];return{path:`
            M ${a} ${i}
              ${r} ${p}
          `,value1:n,value2:m}}),this._curves}get valueLinesPoints(){const t=this.options.width-this.paddingX*2,e=this.options.height-this.paddingY*2;return this._valueLinesPoints=this._valueLinesPoints||Y(this.lines,this.minAvailableLine,this.maxAvailableLine).map(({ratio:a,label:i,value:n,valueDifference:r},p)=>{const m=this.paddingX+t/(this.lines.length-1)*p,o=this.paddingY+(e-e*a);return{x:m,y:o,label:i,value:n,valueDifference:r}}),this._valueLinesPoints}get width(){return this.options.width}get height(){return this.options.height}get lines(){const t=[];for(let e=0;e<this.valueLinesCount;e++){const a=this.minAvailableLine+this.valueLinesStep*e;t.push({value:a,label:`${a}`})}return t}get valueLinesStep(){return Math.round((this.maxAvailableLine-this.minAvailableLine)/this.valueLinesCount)}get valueLinesCount(){const t=this.maxAvailableLine-this.minAvailableLine;return t<=10?3:t<=20?4:10}get minAvailableLine(){const t=Math.pow(10,`${this.minAvailableValue}`.length-1);return Math.floor(this.minAvailableValue/t)*t}get maxAvailableLine(){const t=Math.pow(10,`${this.maxAvailableValue}`.length-1);return Math.ceil(this.maxAvailableValue/t)*t}get minAvailableValue(){return Math.min(...this.availableValues)}get maxAvailableValue(){return Math.max(...this.availableValues)}get availableValues(){return this.values.map(({value:t})=>Number(t))}}const st={class:"chart__inner"},nt=["data-label"],ut=["viewBox"],at=["d"],ot=["d"],lt=["onClick","onMouseover"],rt={class:"chart__popovers"},ct=z({name:"Chart",props:{chart:null},setup(s){const t=M(null);H("getUiTooltipContainer",()=>{var n;return(n=t.value)==null?void 0:n.querySelector(".chart__inner")});const e=M(null);function a(n){return e.value===n}function i(n){e.value=n}return(n,r)=>{const p=$("UiText"),m=$("UiPopover");return _(),d("div",{ref_key:"root",ref:t,class:"chart"},[D("div",st,[(_(!0),d(x,null,A(s.chart.valueLinesPoints,(o,c)=>(_(),d("div",{key:`line-${c}`,class:"chart__value-line",style:w({top:`${100*o.y/s.chart.height}%`}),"data-label":o.label},null,12,nt))),128)),(_(),d("svg",{viewBox:`0 0 ${s.chart.width} ${s.chart.height}`,xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none"},[D("path",{opacity:"0.12",d:s.chart.splitCurves,fill:"#3C8AFF"},null,8,at),(_(!0),d(x,null,A(s.chart.curves,(o,c)=>(_(),d("path",{key:c,d:o.path,class:"chart__curve"},null,8,ot))),128))],8,ut)),(_(!0),d(x,null,A(s.chart.points,(o,c)=>(_(),d("div",{key:`point-zone-${c}`,style:w({left:`${100*o.x/s.chart.width}%`}),class:"chart__point-zone",onClick:b=>i(c),onMouseover:b=>i(c)},[l(p,{size:"m",responsive:""},{default:u(()=>[h(g(o.label),1)]),_:2},1024)],44,lt))),128)),(_(!0),d(x,null,A(s.chart.points,(o,c)=>(_(),d("div",{key:`point-${c}`,class:"chart__point",style:w({left:`${100*o.x/s.chart.width}%`,top:`${100*o.y/s.chart.height}%`})},null,4))),128)),D("div",rt,[(_(!0),d(x,null,A(s.chart.points,(o,c)=>(_(),P(m,{key:`point-${c}`,class:"chart__popover",style:w({left:`${100*o.x/s.chart.width}%`,top:`${100*o.y/s.chart.height}%`}),size:"s",opened:a(c),placement:"top",clickable:!1,onClick:b=>i(c)},{body:u(()=>[R(n.$slots,"point",{point:o})]),_:2},1032,["style","opened","onClick"]))),128))])])],512)}}});const pt={class:"analytics-appointments-page-line-chart"},ht={class:"analytics-appointments-page-line-chart__point"},_t=h(" \u0412\u0441\u044C\u043E\u0433\u043E "),dt=h(" \u0412\u0438\u043A\u043E\u043D\u0430\u043D\u043E "),mt=h(" \u041E\u0444\u043B\u0430\u0439\u043D "),vt=h(" \u041E\u043D\u043B\u0430\u0439\u043D "),ft=z({name:"LineChart",props:{appointmentsList:{type:Array,required:!0}},setup(s){const t=s,e=f(()=>t.appointmentsList.map(i=>({value:i.amount,label:C(i.step).format("DD"),info:i}))),a=M(new it(e.value,{width:768,height:420}));return(i,n)=>{const r=$("UiText");return _(),d("div",pt,[l(ct,{chart:a.value,class:"analytics-appointments-page-line-chart__chart"},{point:u(({point:p})=>[D("div",ht,[l(r,{class:"_blue",size:"m","left-icon":"solid/circle-fill",responsive:""},{append:u(()=>[h(g(p.value),1)]),default:u(()=>[_t]),_:2},1024),l(r,{class:"_green",size:"m","left-icon":"solid/circle-fill",responsive:""},{append:u(()=>[h(g(p.info.completed),1)]),default:u(()=>[dt]),_:2},1024),l(r,{class:"_orange",size:"m","left-icon":"solid/circle-fill",responsive:""},{append:u(()=>[h(g(p.info.offline),1)]),default:u(()=>[mt]),_:2},1024),l(r,{class:"_purple",size:"m","left-icon":"solid/circle-fill",responsive:""},{append:u(()=>[h(g(p.info.online),1)]),default:u(()=>[vt]),_:2},1024)])]),_:1},8,["chart"])])}}});const gt={class:"analytics-appointments-page"},yt={class:"analytics-appointments-page__header"},Ut=z({name:"AppointmentsPage",setup(s){N({title:"\u0410\u043D\u0430\u043B\u0456\u0442\u0438\u043A\u0430 \u043F\u043E \u0437\u0430\u043F\u0438\u0441\u0430\u043C - pullcrm"});const t=j(),e=B(),a=f(()=>e.dates),i=f(()=>a.value[0]),n=f(()=>a.value[1]),r=f(()=>e.appointmentsList),p=f(()=>r.value.map(b=>b.step).join(""));async function m(){if(o()===!1)return t.show({title:"\u0424\u0456\u043B\u044C\u0442\u0440\u0443\u0432\u0430\u043D\u043D\u044F \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0435 \u043F\u0440\u0438 \u0432\u0438\u0431\u043E\u0440\u0456 \u0434\u0430\u0442 \u0432\u0456\u0434 \u0434\u0432\u043E\u0445 \u0434\u043D\u0456\u0432",type:"error"});await e.fetchAppointmentsStats({startDate:C(i.value).format("YYYY-MM-DD"),endDate:C(n.value).format("YYYY-MM-DD")})}function o(){return C(i.value).isSame(C(n.value),"day")===!1}function c(b){return b>new Date(new Date().setHours(0,0,0,0))}return(b,U)=>{const S=$("UiIcon"),T=$("UiText"),V=$("UiPopover");return _(),d("div",gt,[D("div",yt,[l(V,{size:"m",placement:"bottom_start"},{body:u(()=>[l(q,{modelValue:v(a),"onUpdate:modelValue":U[0]||(U[0]=F=>W(a)?a.value=F:null),range:"","disabled-date":c,onInput:m},null,8,["modelValue"])]),default:u(()=>[l(T,{size:"m","right-icon":"outlined/caret-down"},{prepend:u(()=>[l(S,{size:"s",name:"outlined/calendar"})]),default:u(()=>[h(" "+g(v(k)(v(i),"D"))+" - "+g(v(k)(v(n),"D MMMM YYYY")),1)]),_:1})]),_:1})]),l(tt,{class:"analytics-appointments-page__numbers"}),(_(),P(ft,{key:v(p),"appointments-list":v(r)},null,8,["appointments-list"]))])}}});export{Ut as default};
