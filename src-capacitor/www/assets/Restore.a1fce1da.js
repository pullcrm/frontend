var S=Object.defineProperty;var B=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var V=(r,o,a)=>o in r?S(r,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[o]=a,n=(r,o)=>{for(var a in o||(o={}))$.call(o,a)&&V(r,a,o[a]);if(B)for(var a of B(o))x.call(o,a)&&V(r,a,o[a]);return r};import{a4 as R,bx as q,bD as M,r as N,k as _,as as T,aG as m,ay as y,U as L,b1 as l,X as W,a2 as s,W as z,I as G,V as O,a1 as X,D as j,x as H,bp as J}from"./index.53588f62.js";import{u as K}from"./quasar.esm.prod.7cf60e50.js";import{u as Q}from"./toasts.113f48d8.js";import{V as v,b as Y,c as F,d as Z,u as u4}from"./index.e6dcdd48.js";import{_ as e4}from"./Layout.ed4dcc8e.js";import{api as b}from"./api.50e126cb.js";import"./logo.0179c6cf.js";import"./base.686dbe64.js";import"./_commonjsHelpers.2cf1d77b.js";const c4=R({name:"Restore",setup(r){K({title:"\u0412\u0456\u0434\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u044F \u043F\u0430\u0440\u043E\u043B\u044E - pullcrm"});const o=q(),a=M(),U=Q(),e=N({code:"",phone:"",password:"",repeatPassword:""}),d=_(!1),i=_(!1),k={phone:n(n({},v("\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0443")),Y("\u041D\u0435 \u0432\u0456\u0440\u043D\u0438\u0439 \u0444\u043E\u0440\u043C\u0430\u0442 \u043D\u043E\u043C\u0435\u0440\u0443")),code:i.value&&n(n({},F("\u041A\u043E\u0434 \u043C\u0430\u0454 \u0441\u043A\u043B\u0430\u0434\u0430\u0442\u0438\u0441\u044F \u0437 4-\u0445 \u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432",4)),v("\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043A\u043E\u0434 \u043F\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0436\u0435\u043D\u043D\u044F")),password:n(n({},F("\u041C\u0456\u043D\u0456\u043C\u0430\u043B\u044C\u043D\u0430 \u043A\u0456\u043B\u044C\u043A\u0456\u0441\u0442\u044C \u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432: 4",4)),v("\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043D\u043E\u0432\u0438\u0439 \u043F\u0430\u0440\u043E\u043B\u044C")),repeatPassword:n(n({},v("\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043F\u043E\u0432\u0442\u043E\u0440\u043D\u043E \u043D\u043E\u0432\u0438\u0439 \u043F\u0430\u0440\u043E\u043B\u044C")),Z("\u041F\u0430\u0440\u043E\u043B\u0456 \u043D\u0435 \u0441\u043F\u0456\u0432\u043F\u0430\u0434\u0430\u044E\u0442\u044C",e.password))},D=u4(k,e);T(()=>{const{phone:p}=o.query;p&&(e.phone=String(p))});async function P(){if(!!await D.$validate())try{d.value=!0,await b.auth.restore({code:e.code,phone:e.phone,newPassword:e.password}),await U.show({title:"\u041F\u0430\u0440\u043E\u043B\u044C \u0437\u043C\u0456\u043D\u0435\u043D\u043E!"}),w()}catch(u){if([u.status===403&&{field:"code",error:"invalid"}].filter(Boolean).length>0)return;throw u}finally{d.value=!1}}async function g(){if(!!await D.$validate())try{d.value=!0,await b.users.confirmation({phone:e.phone,type:"RESET_PASSWORD"}),i.value=!0}catch(u){if([u.status===404&&{field:"phone",error:"invalid"}].filter(Boolean).length>0)return;throw u}finally{d.value=!1}}function w(){a.push({name:"login",query:n({},o.query)})}return(p,u)=>{const h=m("UiBack"),f=m("UiInput"),E=m("UiField"),I=m("UiButton"),A=m("UiFormValidator");return y(),L(e4,{title:"\u0412\u0456\u0434\u043D\u043E\u0432\u0438\u0442\u0438 \u0434\u043E\u0441\u0442\u0443\u043F","sub-title":"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0443, \u0449\u043E\u0431 \u0432\u0456\u0434\u043D\u043E\u0432\u0438\u0442\u0438 \u0434\u043E\u0441\u0442\u0443\u043F",class:"auth-page-restore"},{default:l(()=>[W("form",{onSubmit:u[4]||(u[4]=J(c=>i.value?P():g(),["prevent"]))},[s(h,{class:"auth-page-restore__back",onClick:w}),s(A,{validate:H(D)},{default:l(({resetFieldError:c,getFieldError:C})=>[s(E,{label:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",error:C("phone")},{default:l(()=>[s(f,{modelValue:e.phone,"onUpdate:modelValue":u[0]||(u[0]=t=>e.phone=t),mask:"+38 (###) #### ###",name:"phone","left-icon":"outlined/phone",inputmode:"tel",placeholder:"066",disabled:i.value,onInput:t=>c("phone")},null,8,["modelValue","disabled","onInput"])]),_:2},1032,["error"]),i.value?(y(),z(G,{key:0},[s(E,{label:"\u041A\u043E\u0434 \u0441\u043C\u0441",error:C("code")},{default:l(()=>[s(f,{modelValue:e.code,"onUpdate:modelValue":u[1]||(u[1]=t=>e.code=t),"left-icon":"outlined/chat-centered-text",placeholder:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u0421\u041C\u0421-\u043A\u043E\u0434",onInput:t=>c("code")},null,8,["modelValue","onInput"])]),_:2},1032,["error"]),s(E,{label:"\u041F\u0430\u0440\u043E\u043B\u044C",error:C("password")},{default:l(()=>[s(f,{modelValue:e.password,"onUpdate:modelValue":u[2]||(u[2]=t=>e.password=t),"left-icon":"outlined/key",name:"password",type:"password",placeholder:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043D\u043E\u0432\u0438\u0439 \u043F\u0430\u0440\u043E\u043B\u044C",onInput:t=>c("password")},null,8,["modelValue","onInput"])]),_:2},1032,["error"]),s(E,{label:"\u041F\u043E\u0432\u0442\u043E\u0440\u0456\u0442\u044C \u043F\u0430\u0440\u043E\u043B\u044C",error:C("repeatPassword")},{default:l(()=>[s(f,{modelValue:e.repeatPassword,"onUpdate:modelValue":u[3]||(u[3]=t=>e.repeatPassword=t),"left-icon":"outlined/key",name:"repeatPassword",type:"password",placeholder:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043F\u043E\u0432\u0442\u043E\u0440\u043D\u043E \u043D\u043E\u0432\u0438\u0439 \u043F\u0430\u0440\u043E\u043B\u044C",onInput:t=>c("repeatPassword")},null,8,["modelValue","onInput"])]),_:2},1032,["error"])],64)):O("",!0),s(I,{class:"auth-page-restore__button",type:"submit",size:"l",theme:"blue",loading:d.value},{default:l(()=>[X(j(i.value?"\u0417\u043C\u0456\u043D\u0438\u0442\u0438 \u043F\u0430\u0440\u043E\u043B\u044C":"\u0412\u0456\u0434\u043D\u043E\u0432\u0438\u0442\u0438"),1)]),_:1},8,["loading"])]),_:1},8,["validate"])],32)]),_:1})}}});export{c4 as default};
